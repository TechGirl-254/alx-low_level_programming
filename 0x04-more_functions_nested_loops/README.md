This contains more nested loops
